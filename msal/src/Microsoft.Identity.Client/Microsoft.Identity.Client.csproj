<Project Sdk="MSBuild.Sdk.Extras/1.5.4">

  <PropertyGroup>
    <TargetFrameworks>net45;netstandard1.3;uap10.0;MonoAndroid8.1;Xamarin.iOS10;netcoreapp1.0</TargetFrameworks>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <SignAssembly>true</SignAssembly>
    <AssemblyOriginatorKeyFile>../../../build/35MSSharedLib1024.snk</AssemblyOriginatorKeyFile>
    <DebugType>full</DebugType>
    <DelaySign>true</DelaySign>
  </PropertyGroup>

  <PropertyGroup Label="GenerateAssemblyInfo inputs">
    <!-- This should be passed from the VSTS build -->
    <MsalClientSemVer Condition="'$(MsalClientSemVer)' == ''">1.0.0-localbuild</MsalClientSemVer>

    <!-- This will generate AssemblyVersion, AssemblyFileVersion and AssemblyInformationVersion -->
    <Version>$(MsalClientSemVer)</Version>

    <Copyright>Copyright (c) Microsoft Corporation. All rights reserved.</Copyright>
    <Company>Microsoft Corporation</Company>
    <Product>Microsoft Authentication Library</Product>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'netcoreapp1.0' ">
    <DefineConstants>$(DefineConstants);NET_CORE</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'uap10.0' ">
    <DefineConstants>$(DefineConstants);WINDOWS_APP</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'MonoAndroid8.1'">
    <DefineConstants>$(DefineConstants);ANDROID</DefineConstants>
    <NoWarn>$(NoWarn);CS8002</NoWarn>
    <MonoAndroidResourcePrefix>Resources</MonoAndroidResourcePrefix>
    <AndroidResgenFile>Resources\Resource.designer.cs</AndroidResgenFile>
    <AndroidResgenClass>Resource</AndroidResgenClass>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'net45'">
    <DefineConstants>$(DefineConstants);DESKTOP</DefineConstants>
    <NoWarn>$(NoWarn);CS8002</NoWarn>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'Xamarin.iOS10'">
    <DefineConstants>$(DefineConstants);iOS</DefineConstants>
    <NoWarn>$(NoWarn);CS8002</NoWarn>
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFramework)' == 'netstandard1.3'">
    <DefineConstants>$(DefineConstants)</DefineConstants>
    <NoWarn>$(NoWarn);CS8002</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\..\core\src\Microsoft.Identity.Core.csproj" />
  </ItemGroup>
  <ItemGroup>
    <!-- This None is here so the conditionally included files show up in the Solution Explorer -->
    <None Include="**\*.cs;**\*.xml;**\*.axml" Exclude="obj\**\*.*;bin\**\*.*" />
    <Compile Remove="Platforms\**\*.*" />
    <Compile Remove="Features\**\*.*" />
    <None Remove="Features\ConfidentialClient\IConfidentialClientApplicationWithCertificate.cs" />
    <EmbeddedResource Include="Properties\Microsoft.Identity.Client.rd.xml" />
  </ItemGroup>
  <ItemGroup Condition="'$(TargetFramework)' == 'netstandard1.3'">
    <PackageReference Include="System.Runtime.Serialization.Primitives" Version="4.3.0" />
    <PackageReference Include="System.Runtime.Serialization.Json" Version="4.3.0" />
    <PackageReference Include="System.Xml.XDocument" Version="4.3.0" />
    <PackageReference Include="System.Security.Cryptography.X509Certificates" Version="4.3.0" Condition="'$(TargetFramework)' != 'netstandard1.1'" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'netcoreapp1.0' ">
    <!-- Remove UI specific logic as it is not supported yet -->
    <Compile Remove="UIParent.cs" />
    <Compile Include="Platforms\netcore\*.cs" />
    <Compile Include="Features\TokenCache\**\*.cs" />
    <Compile Include="Features\ConfidentialClient\**\*.cs" />
    <Compile Include="Features\EventSource\**\*.cs" />
    <PackageReference Include="System.Runtime.Serialization.Primitives" Version="4.3.0" />
    <PackageReference Include="System.Runtime.Serialization.Json" Version="4.3.0" />
    <PackageReference Include="System.Xml.XDocument" Version="4.3.0" />
    <PackageReference Include="System.Net.NameResolution" Version="4.3.0" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'net45' ">
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.IdentityModel" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Xml" />
    <Compile Include="Platforms\net45\*.cs" />
    <Compile Include="Features\EventSource\**\*.cs" />
    <Compile Include="Features\TokenCache\**\*.cs" />
    <Compile Include="Features\PublicClient\**\*.cs" />
    <Compile Include="Features\*.cs" />
    <Compile Include="Features\ConfidentialClient\**\*.cs" />
    <Compile Update="Platforms\net45\CustomWebBrowser.CustomWebBrowserEvent.cs" SubType="Component" />
    <Compile Update="Platforms\net45\CustomWebBrowser.cs" SubType="Component" />
    <Compile Update="Platforms\net45\WinFormWebAuthenticationDialog.cs" SubType="Form" />
    <Compile Update="Platforms\net45\WindowsFormsWebAuthenticationDialogBase.cs" SubType="Form" />
    <Compile Update="Platforms\net45\SilentWindowsFormsAuthenticationDialog.cs" SubType="Form" />
  </ItemGroup>
  <ItemGroup Condition="'$(TargetFramework)' == 'uap10.0' ">
    <Compile Include="Platforms\uap\*.cs" />
    <Compile Include="Features\EventSource\**\*.cs" />
    <Compile Include="Features\PublicClient\**\*.cs" />
    <Compile Include="Features\*.cs" />
  </ItemGroup>
  <ItemGroup Condition="'$(TargetFramework)' == 'netstandard1.3' ">
    <Compile Include="Platforms\netstandard1.3\**\*.cs" />
    <Compile Include="Features\PublicClient\**\*.cs" />
    <Compile Include="Features\ConfidentialClient\**\*.cs" />
    <Compile Include="Features\EventSource\**\*.cs" />
    <Compile Include="Features\TokenCache\**\*.cs" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'uap10.0' ">
    <PackageReference Include="System.Runtime.Serialization.Primitives" Version="4.3.0" />
    <PackageReference Include="System.Runtime.Serialization.Json" Version="4.3.0" />
    <PackageReference Include="System.Xml.XDocument" Version="4.3.0" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'Xamarin.iOS10' ">
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.IdentityModel" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Runtime.Serialization" />
    <Reference Include="System.Xml" />
    <Reference Include="System.Xml.Linq" />
    <Compile Include="Platforms\iOS\**\*.cs" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'MonoAndroid8.1' ">
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.IdentityModel" />
    <Reference Include="System.Runtime.Serialization" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Xml" />
    <PackageReference Include="Xamarin.Android.Support.CustomTabs">
      <Version>27.0.2</Version>
    </PackageReference>
    <PackageReference Include="Xamarin.Android.Support.v7.AppCompat">
      <Version>27.0.2</Version>
    </PackageReference>
    <Compile Include="Platforms\Android\**\*.cs" />
  </ItemGroup>

  <!-- This is here to workaround designer issues so VS sees them appropriately -->
  <ItemGroup>
    <None Update="Platforms\net45\CustomWebBrowser.CustomWebBrowserEvent.cs" SubType="Component" />
    <None Update="Platforms\net45\CustomWebBrowser.cs" SubType="Component" />
    <None Update="Platforms\net45\WinFormWebAuthenticationDialog.cs" SubType="Form" />
    <None Update="Platforms\net45\WindowsFormsWebAuthenticationDialogBase.cs" SubType="Form" />
    <None Update="Platforms\net45\SilentWindowsFormsAuthenticationDialog.cs" SubType="Form" />
  </ItemGroup>

  <!-- Copies all artifacts needed to generate the nuget package. This should be replaced with msbuild /t:pack, however
  bug https://github.com/NuGet/Home/issues/3891 blocks this, espcially that packaging rebuilds the Core assemblies, so we cannot sign it.-->
  <Target Name="LayoutNuGet">
    <PropertyGroup>
      <NugetPackageRootFolder Condition="'$(NugetPackageRootFolder)' == ''">$([System.IO.Path]::Combine($(MSBuildThisFileDirectory), "..",".nugetlayout"))</NugetPackageRootFolder>
      <NuspecFilePath>$([System.IO.Path]::Combine($(MSBuildThisFileDirectory), "..", "..", "build", "Microsoft.Identity.Client.nuspec"))</NuspecFilePath>
    </PropertyGroup>
    <ItemGroup>
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Client.dll" />
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Client.xml" />
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Client.pdb" />
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Core.dll" />
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Core.xml" />
      <FilesToPack Include="bin\$(Configuration)\**\Microsoft.Identity.Core.pdb" />
    </ItemGroup>

    <RemoveDir Directories="$(NugetPackageRootFolder)" />
    <Copy SourceFiles="@(FilesToPack)" DestinationFiles="$(NugetPackageRootFolder)\lib\%(RecursiveDir)%(FileName)%(Extension)" />
    <Copy SourceFiles="$(NuspecFilePath)" DestinationFolder="$(NugetPackageRootFolder)" />
  </Target>

  <PropertyGroup>
    <CodeAnalysisRuleSet>../../../core/ConfigureAwait.ruleset</CodeAnalysisRuleSet>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="AsyncUsageAnalyzers" Version="1.0.0-alpha003" PrivateAssets="All" />
  </ItemGroup>
</Project>
